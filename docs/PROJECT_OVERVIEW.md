# CyFishON - Техническое описание проекта

## 1. Обзор проекта

**CyFishON** - мобильное приложение для рыбаков Кипра, позволяющее быстро делиться информацией о поимках тунца с сообществом.

**Ключевые особенности:**
- Работает полностью офлайн
- Автоматическая синхронизация при появлении интернета
- Простой интерфейс с тремя кнопками
- Локальное хранение всех данных

## 2. Основные функции

### 2.1 Отправка информации о поимке
- **FishON** - обычная поимка
- **Double** - двойная поимка
- **Triple EPTA** - тройная или больше

### 2.2 Автоматическое получение данных
- GPS координаты (точность ±5м)
- Время поимки
- Имя рыбака

### 2.3 Многоуровневое сохранение
1. **Локально** - SQLite база на телефоне
2. **Telegram** - отправка боту для публикации в чат
3. **Сервер** - глобальная база данных (будущее)

## 3. Офлайн-first архитектура

```
┌─────────────────┐
│ Действие        │
│ пользователя    │
└────────┬────────┘
         ▼
┌─────────────────┐
│ Локальная БД    │ ← Всегда доступна
│ (SQLite)        │
└────────┬────────┘
         ▼
┌─────────────────┐
│ Очередь         │
│ синхронизации   │
└────────┬────────┘
         ▼
┌─────────────────┐
│ Проверка        │
│ интернета       │
└────────┬────────┘
         ▼
    ┌────┴────┐
    │ Есть?   │
    └────┬────┘
    Да   │   Нет
    ▼    │    ▼
┌──────┐ │ ┌────────┐
│Отпра-│ │ │Повтор  │
│вить  │ │ │через   │
└──────┘ │ │5 минут │
         │ └────────┘
         ▼
    ┌─────────┐
    │Обновить │
    │статус   │
    └─────────┘
```

## 4. Структура данных

### 4.1 Модель поимки (CatchRecord)
```dart
{
  id: int,
  timestamp: DateTime,
  userName: String,
  latitude: double,
  longitude: double,
  catchType: String, // 'fishon', 'double', 'triple'
  telegramStatus: String, // 'pending', 'sent', 'failed'
  serverStatus: String, // 'pending', 'sent', 'failed'
  retryCount: int,
  lastError: String?
}
```

### 4.2 Формат сообщения в Telegram
```
Есть контакт от <Имя>; координаты
<широта в формате градусы°минуты.тысячные′>
<долгота в формате градусы°минуты.тысячные′>
<суффикс>
```

Суффиксы:
- Пусто - для FishON
- "Double" - для двойной
- "Triple ЕПТА!" - для тройной

## 5. Экраны приложения

### 5.1 Главный экран
- Текущие координаты с таймером обновления
- Последние 3 поимки (все участники)
- Три большие кнопки действий

### 5.2 История поимок
- Список всех поимок
- Фильтр: "Все" / "Только мои"
- Индикаторы статуса отправки

### 5.3 Карта
- Заглушка для будущей разработки

### 5.4 Логи
- Технические логи всех действий
- Статусы отправок
- Ошибки и их причины

### 5.5 Настройки
- Имя (макс 13 символов)
- Интервал повторных попыток

## 6. Навигация
```
┌─────┬─────┬─────┬─────┐
│  🎣 │  📋 │  🗺️ │  📄 │
├─────┼─────┼─────┼─────┤
│Глав-│Исто-│Карта│Логи │
│ная  │рия  │     │     │
└─────┴─────┴─────┴─────┘
```

## 7. Технические требования

### 7.1 Таймауты и интервалы
- Таймаут отправки: 10 секунд
- Проверка интернета: каждые 10 секунд
- Повтор при ошибке: через 5 минут (настраивается)
- Максимум попыток: без ограничений

### 7.2 Хранение данных
- Поимки: вечное хранение
- Логи: 30 дней
- Настройки: SharedPreferences

### 7.3 API Telegram
- Bot Token: 8017367144:AAEO257fAdCJ_ghankGbx0WVX2RZklQiwqE
- Group ID: -4881811622

## 8. Будущие улучшения
1. Карта с отметками поимок
2. Push-уведомления о поимках рядом
3. Статистика и аналитика
4. Фото поимок
5. Погодные условия

## 9. Правила разработки
1. Код должен быть простым и понятным
2. Все функции должны работать офлайн
3. Обязательные комментарии к логике
4. Обновление документации при изменениях
5. Тестирование в условиях плохой связи
